<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Page Title</title>
    <style>
        /* Inline CSS styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            color: #333;
        }
        h1 {
            color: #007BFF;
        }
        .score {
            width: 50%;
            height: 80%;
            min-width: 200px;
            min-height: 200px;
            resize: both;
            overflow: auto;
            border: 1px solid #333;
            display: flex;
            flex-wrap: wrap;
        }
        .bar {
            height: 32px;
            width: 128px;
            background-color: #007BFF;
            margin: 2px;
            cursor: move; /* Change cursor to indicate draggable */
            display: flex;
            align-items: center; /* Center text vertically */
            justify-content: center; /* Center text horizontally */
        }
        .selected {
            background-color: lightcoral; /* Light red color for selected bars */
        }
        .edit-input {
            height: 32px;
            width: 128px;
            border: none;
            padding: 0;
            margin: 0;
            font-size: 16px;
            text-align: center;
        }
    </style>
    <script>
        // Inline JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const bars = document.querySelectorAll('.bar');
            let lastSelectedIndex = -1;

            bars.forEach((bar, index) => {
                bar.setAttribute('draggable', true);

                bar.addEventListener('dragstart', (e) => {
                    const selectedBars = document.querySelectorAll('.bar.selected');
                    const selectedTexts = Array.from(selectedBars).map(selectedBar => selectedBar.innerText);
                    e.dataTransfer.setData('text/plain', JSON.stringify(selectedTexts));
                    e.dataTransfer.effectAllowed = 'move';
                });

                bar.addEventListener('dragover', (e) => {
                    e.preventDefault(); // Allow drop
                });

                bar.addEventListener('drop', (e) => {
                    console.log('drop');
                    e.preventDefault();
                    const draggedTexts = JSON.parse(e.dataTransfer.getData('text/plain'));
                    const target = e.target;
                    console.log(target);
                    if (target.classList.contains('bar')) {
                        const parent = target.parentNode;
                        const targetIndex = Array.from(parent.children).indexOf(target);
                        const selectedBars = Array.from(parent.querySelectorAll('.bar.selected'));
                        console.log(selectedBars);
                        // Insert dragged elements in the order they were selected
                        selectedBars.forEach(draggedElement => {
                            console.log(draggedElement);
//                            parent.insertBefore(draggedElement, parent.children[targetIndex]);
                            parent.insertBefore(draggedElement, target);
                        });
                    }
                });

                bar.addEventListener('click', (e) => {
                    if (e.shiftKey && lastSelectedIndex !== -1) {
                        // Select range of bars
                        const start = Math.min(lastSelectedIndex, index);
                        const end = Math.max(lastSelectedIndex, index);
                        for (let i = start; i <= end; i++) {
                            bars[i].classList.add('selected');
                        }
                    } else {
                        // Toggle selection of the clicked bar
                        bar.classList.toggle('selected');
                    }
                    lastSelectedIndex = index; // Update last selected index
                });

                // Double-click to edit
                bar.addEventListener('dblclick', () => {
                    const currentText = bar.innerText;
                    const input = document.createElement('input');
                    input.value = currentText;
                    input.className = 'edit-input';
                    bar.innerHTML = ''; // Clear the bar content
                    bar.appendChild(input);
                    input.focus();

                    // Handle enter key to save changes
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            bar.innerText = input.value; // Set the bar text to the input value
                        }
                    });

                    // Handle blur event to save changes when input loses focus
                    input.addEventListener('blur', () => {
                        bar.innerText = input.value; // Set the bar text to the input value
                    });
                });
            });

            // Event listener for deleting selected bars
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Delete' || e.key === 'Backspace') {
                    const selectedBars = document.querySelectorAll('.bar.selected');
                    selectedBars.forEach(selectedBar => {
                        selectedBar.remove();
                    });
                } else if (e.key === '+') {
                    const selectedBars = document.querySelectorAll('.bar.selected');
                    const newBar = document.createElement('div');
                    newBar.className = 'bar';
                    newBar.innerText = `Item ${document.querySelectorAll('.bar').length + 1}`; // Incremental item name

                    if (selectedBars.length > 0) {
                        const lastSelectedBar = selectedBars[selectedBars.length - 1];
                        lastSelectedBar.parentNode.insertBefore(newBar, lastSelectedBar.nextSibling);
                    } else {
                        const scoreDiv = document.querySelector('.score');
                        scoreDiv.insertBefore(newBar, scoreDiv.firstChild); // Add before all other bars
                    }
                }
            });
        });
    </script>
</head>
<body>
    <h1>Welcome to Your Page</h1>
    <p>This is a basic HTML structure.</p>
    <div class="score">
        <div class="bar">Item 1</div>
        <div class="bar">Item 2</div>
        <div class="bar">Item 3</div>
        <div class="bar">Item 4</div>
        <div class="bar">Item 5</div>
        <div class="bar">Item 6</div>
        <div class="bar">Item 7</div>
        <div class="bar">Item 8</div>
    </div>
    <!-- Add your content here -->
</body>
</html>
