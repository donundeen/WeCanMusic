<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Page Title</title>
    <style>
        /* Inline CSS styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            color: #333;
        }
        h1 {
            color: #007BFF;
        }
        .score {
            width: 50%;
            height: 80%;
            min-width: 200px;
            min-height: 200px;
            resize: both;
            overflow: auto;
            border: 1px solid #333;
            display: flex;
            flex-wrap: wrap;
        }
        .bar {
            height: 32px;
            width: 128px;
            background-color: #007BFF;
            margin: 2px;
            cursor: move; /* Change cursor to indicate draggable */
            display: flex;
            align-items: center; /* Center text vertically */
            justify-content: center; /* Center text horizontally */
            position: relative; /* For positioning the number */
        }
        .selected {
            background-color: lightcoral; /* Light red color for selected bars */
        }
        .edit-input {
            height: 32px;
            width: 128px;
            border: none;
            padding: 0;
            margin: 0;
            font-size: 16px;
            text-align: center;
        }
        .number {
            position: absolute;
            top: 2px;
            left: 2px;
            font-size: 12px;
            color: white; /* Color for the number */
        }
        .text {
            height: 100%; /* Same height as the bar */
            width: 100%; /* Same width as the bar */
            border: none;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center; /* Center text vertically */
            justify-content: center; /* Center text horizontally */
            position: absolute; /* Position it over the bar */
            top: 0; /* Align to the top */
            left: 0; /* Align to the left */
            padding-left: 20px; /* Leave space for the number */
            box-sizing: border-box; /* Include padding in width/height */
        }
    </style>
    <script>
        // Inline JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            const barsContainer = document.querySelector('.score');
            let lastSelectedIndex = -1;

            function updateNumbers() {
                const bars = document.querySelectorAll('.bar');
                bars.forEach((bar, index) => {
                    const numberElement = bar.querySelector('.number');
                    if (numberElement) {
                        numberElement.innerText = index + 1; // Update the number
                    } else {
                        const newNumberElement = document.createElement('div');
                        newNumberElement.className = 'number';
                        newNumberElement.innerText = index + 1; // Set the number
                        bar.appendChild(newNumberElement);
                    }
                });
            }

            for (let i = 0; i < 8; i++) {
                const bar = document.createElement('div');
                bar.className = 'bar';
                bar.innerHTML = `<div class="number"></div><div class="text"></div>`; // Create number and text divs
                barsContainer.appendChild(bar);
            }

            const bars = document.querySelectorAll('.bar');
            updateNumbers(); // Initial numbering

            bars.forEach((bar, index) => {
                bar.setAttribute('draggable', true);

                bar.addEventListener('dragstart', (e) => {
                    const selectedBars = document.querySelectorAll('.bar.selected');
                    const selectedTexts = Array.from(selectedBars).map(selectedBar => selectedBar.querySelector('.text').innerText);
                    e.dataTransfer.setData('text/plain', JSON.stringify(selectedTexts));
                    e.dataTransfer.effectAllowed = 'move';
                });

                bar.addEventListener('dragover', (e) => {
                    e.preventDefault(); // Allow drop
                });

                bar.addEventListener('drop', (e) => {
                    console.log("drop");
                    e.preventDefault();
                    const draggedTexts = JSON.parse(e.dataTransfer.getData('text/plain'));
                    let target = e.target;
                    if(!target.classList.contains('bar')){
                        target = target.parentNode;
                    }
                    console.log(target);
                    if (target.classList.contains('bar')) {
                        const parent = target.parentNode;
                        const selectedBars = Array.from(parent.querySelectorAll('.bar.selected'));
                        const targetIndex = Array.from(parent.children).indexOf(target);
                        // Insert dragged elements in the order they were selected
                        /*DO NOT CHANGE THIS CODE*/
                        selectedBars.forEach(draggedElement => {
                            console.log(draggedElement);
                            parent.insertBefore(draggedElement, target);
                        });
                        /* END DO NOT CHANGE THIS CODE*/

                        updateNumbers(); // Update numberinshg after drop
                    }
                });

                bar.addEventListener('click', (e) => {
                    if (e.shiftKey && lastSelectedIndex !== -1) {
                        // Select range of bars
                        const start = Math.min(lastSelectedIndex, index);
                        const end = Math.max(lastSelectedIndex, index);
                        for (let i = start; i <= end; i++) {
                            bars[i].classList.add('selected');
                        }
                    } else {
                        // Toggle selection of the clicked bar
                        bar.classList.toggle('selected');
                    }
                    lastSelectedIndex = index; // Update last selected index
                });

                // Double-click to edit
                bar.addEventListener('dblclick', () => {
                    const textDiv = bar.querySelector('.text');
                    const currentText = textDiv.innerText;
                    const input = document.createElement('input');
                    input.value = currentText;
                    input.className = 'edit-input';
                    textDiv.innerHTML = ''; // Clear the text div content
                    textDiv.appendChild(input);
                    input.focus();

                    // Handle enter key to save changes
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            textDiv.innerText = input.value; // Set the text div to the input value
                        }
                    });

                    // Handle blur event to save changes when input loses focus
                    input.addEventListener('blur', () => {
                        textDiv.innerText = input.value; // Set the text div to the input value
                    });
                });
            });

            // Event listener for deleting selected bars
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Delete' || e.key === 'Backspace') {
                    const selectedBars = document.querySelectorAll('.bar.selected');
                    selectedBars.forEach(selectedBar => {
                        selectedBar.remove();
                    });
                    updateNumbers(); // Update numbering after deletion
                } else if (e.key === '+') {
                    const selectedBars = document.querySelectorAll('.bar.selected');
                    const newBar = document.createElement('div');
                    newBar.className = 'bar';
                    newBar.innerHTML = `<div class="number"></div><div class="text"></div>`; // Create number and text divs

                    if (selectedBars.length > 0) {
                        const lastSelectedBar = selectedBars[selectedBars.length - 1];
                        lastSelectedBar.parentNode.insertBefore(newBar, lastSelectedBar.nextSibling);
                    } else {
                        const scoreDiv = document.querySelector('.score');
                        scoreDiv.insertBefore(newBar, scoreDiv.firstChild); // Add before all other bars
                    }
                    updateNumbers(); // Update numbering after addition
                } else if (e.key === 'ArrowRight') { // Add this block for moving selected bars forward
                    let selectedBars = document.querySelectorAll('.bar.selected');
                    selectedBars = Array.from(selectedBars).reverse();
                    selectedBars.forEach(selectedBar => {
                        if(!selectedBar.previousElementSibling ||!selectedBar.previousElementSibling.classList.contains('selected')){    
                            let nextBar = selectedBar.nextElementSibling;
                            while(nextBar && nextBar.classList.contains('selected')){
                                nextBar = nextBar.nextElementSibling;
                            }
                            if (nextBar && nextBar.classList.contains('bar')) {
                                selectedBar.parentNode.insertBefore(nextBar, selectedBar); // Move next bar before the selected bar
                            }
                        }
                    });
                    updateNumbers(); // Update numbering after moving
                 } else if (e.key === 'ArrowLeft') { // Move selected bars backward
                    const selectedBars = Array.from(document.querySelectorAll('.bar.selected'));
                    if (selectedBars.length > 0) {
                        let firstSelectedBar = selectedBars[0];
                        let previousBar = firstSelectedBar.previousElementSibling;

                        if (previousBar && previousBar.classList.contains('bar')) {
                            selectedBars.forEach(selectedBar => {
                                previousBar = selectedBar.previousElementSibling;
                                const parent = selectedBar.parentNode;
                                parent.insertBefore(selectedBar, previousBar); // Move each selected bar before the previous bar
                            });
                            updateNumbers(); // Update numbering after moving
                        }
                    }
                }
            });
        });
    </script>
</head>
<body>
    <h1>Welcome to Your Page</h1>
    <p>This is a basic HTML structure.</p>
    <div class="score">
        <!-- Bar elements will be dynamically created in JavaScript -->
    </div>
    <!-- Add your content here -->
</body>
</html>
